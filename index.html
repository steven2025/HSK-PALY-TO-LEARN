<!doctype html><html><head><meta charset='utf-8'><title>HSK</title>
<style id="bgm-style-2025-10-28">
  #bgm-toggle{
    position: fixed; left: 14px; bottom: 112px; z-index: 9999;
    padding: 8px 12px; border: none; border-radius: 999px;
    background: #222; color: #fff; font-weight: 700; font-size: 13px;
    box-shadow: 0 8px 24px rgba(0,0,0,.25); cursor: pointer; opacity: .9;
  }
  #bgm-toggle:hover{ opacity: 1; }
  #bgm-panel{
    position: fixed; left: 14px; bottom: 64px; z-index: 9999;
    display: flex; align-items: center; gap: 8px;
    background: rgba(0,0,0,.75); color:#fff; padding: 8px 10px; border-radius: 12px;
    box-shadow: 0 8px 24px rgba(0,0,0,.25);
  }
  #bgm-volume{ width: 140px; height: 6px; accent-color: #ff6a00; }
  @media (max-width: 480px){ #bgm-volume{ width: 110px; } }
</style>

</head><body><div>Placeholder index</div>
<audio id="bgm-audio" src="./audio/bgm.mp3" preload="auto" loop playsinline webkit-playsinline></audio>
<div id="bgm-panel" role="group" aria-label="ËÉåÊôØÈü≥‰πêÊéßÂà∂ / BGM Controls">
  <button id="bgm-toggle" aria-label="Èü≥‰πêÂºÄÂÖ≥ / Music">üîà ÂºÄÂêØÈü≥‰πê ¬∑ Music</button>
  <input id="bgm-volume" type="range" min="0" max="100" step="1" value="40" aria-label="Èü≥Èáè Volume">
</div>


<script id="bgm-ctrl-2025-10-28">
(function(){
  const audio = document.getElementById('bgm-audio');
  const toggle = document.getElementById('bgm-toggle');
  const slider = document.getElementById('bgm-volume');
  if(!audio || !toggle || !slider) return;

  const KEY_ON = 'hsk_bgm_on';
  const KEY_VOL = 'hsk_bgm_vol';

  let on = localStorage.getItem(KEY_ON) === '1';
  let vol = parseFloat(localStorage.getItem(KEY_VOL) || '0.4');
  if (Number.isNaN(vol)) vol = 0.4;
  audio.volume = Math.min(1, Math.max(0, vol));
  slider.value = Math.round(audio.volume * 100);

  function label(){
    toggle.textContent = on ? 'üîä ÂÖ≥Èó≠Èü≥‰πê ¬∑ Mute' : 'üîà ÂºÄÂêØÈü≥‰πê ¬∑ Music';
  }
  label();

  async function safePlay(){
    try { await audio.play(); } catch(e) { /* wait for user gesture */ }
  }

  const onceStart = () => { if(on) safePlay(); document.removeEventListener('click', onceStart); };
  document.addEventListener('click', onceStart, {once:true});

  document.addEventListener('WeixinJSBridgeReady', () => { if(on) safePlay(); }, false);
  document.addEventListener('YixinJSBridgeReady',  () => { if(on) safePlay(); }, false);

  document.addEventListener('visibilitychange', () => {
    if(document.hidden){ audio.pause(); }
    else if(on){ safePlay(); }
  });

  toggle.addEventListener('click', async () => {
    on = !on; localStorage.setItem(KEY_ON, on ? '1':'0'); label();
    if(on){ await safePlay(); } else { audio.pause(); }
  });

  slider.addEventListener('input', () => {
    const v = Math.max(0, Math.min(100, parseInt(slider.value || '0', 10))) / 100;
    audio.volume = v;
    localStorage.setItem(KEY_VOL, String(v));
  });
})();
</script>

</body></html>